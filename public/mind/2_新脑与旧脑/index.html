<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="light">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>新脑与旧脑 | 祁观</title>
<meta name="keywords" content="">
<meta name="description" content="新旧脑对比以及皮质柱。">
<meta name="author" content="祁新">
<link rel="canonical" href="http://localhost:1313/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script>
    
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="祁观 (Alt + H)">祁观</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/worldview/" title="世界观">
                    <span>世界观</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/evolution/" title="变化与选择">
                    <span>变化与选择</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/freedom/" title="不朽与自由">
                    <span>不朽与自由</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/mind/" title="心智模型">
                    <span>心智模型</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于我">
                    <span>关于我</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      新脑与旧脑
    </h1>
    <div class="post-meta"><span title='2025-05-23 00:00:00 +0000 UTC'>May 23, 2025</span>&nbsp;·&nbsp;<span>祁新</span>

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="http://localhost:1313/images/cover/%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91.jpeg" alt="封面图片">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%96%b0%e8%84%91%e4%b8%8e%e6%97%a7%e8%84%91" aria-label="新脑与旧脑">新脑与旧脑</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%96%b0%e8%84%91" aria-label="新脑">新脑</a></li>
                <li>
                    <a href="#%e6%97%a7%e8%84%91" aria-label="旧脑">旧脑</a></li>
                <li>
                    <a href="#%e8%84%91%e5%8c%ba" aria-label="脑区">脑区</a></li>
                <li>
                    <a href="#%e6%96%b0%e6%97%a7%e8%84%91%e7%9a%84%e5%88%86%e5%b7%a5" aria-label="新旧脑的分工">新旧脑的分工</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e7%9a%ae%e8%b4%a8%e6%9f%b1" aria-label="皮质柱">皮质柱</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="新脑与旧脑">新脑与旧脑<a hidden class="anchor" aria-hidden="true" href="#新脑与旧脑">#</a></h1>
<h3 id="新脑">新脑<a hidden class="anchor" aria-hidden="true" href="#新脑">#</a></h3>
<p>人脑中的最新部分是新皮质，哺乳动物都有新皮质，而且只有哺乳动物才有新皮质。</p>
<p>新皮质，也叫做新脑，是大脑的分析引擎。它能识别物体、学习语言或理解概念。新皮层接收大量的感官输入并对其进行理解。新皮层学习各种事物，建立内部模型。例如，通过观察、触摸和聆听一只猫，新皮层构建了猫的模型。该模型不仅包括猫的外观、触感和声音，还包括它的行为。此外，新皮层还构建一些我们无法直接感知的抽象事物的模型，例如 “国家” 或 “公平”。</p>
<p>人脑的新皮质特别大，约占大脑体积的70%。如果把新皮质铺平，它有一张桌布那么大但更厚，厚度则约是2.5毫米，它包裹着旧脑部分。我们看到一个大脑时，其外部大部分是新皮质及其特有的褶皱，只有小部分是旧脑，脊髓则从底部延伸出来。</p>
<p><img loading="lazy" src="/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/%E6%96%B0%E7%9A%AE%E8%B4%A8.gif#center">
图片来自<a href="https://www.vjnuance.idv.tw/2008/12/blog-post_77.html">网站</a>。</p>
<p>呼吸、饮食、性和条件反射这些至关重要的功能位于旧脑。</p>
<p>新脑是智能的器官。几乎所有智能，诸如视觉、语言、音乐、数学、科学和工程，都是由新皮脑创造的。当我们思考问题时，主要是新脑在思考。</p>
<h3 id="旧脑">旧脑<a hidden class="anchor" aria-hidden="true" href="#旧脑">#</a></h3>
<p>旧脑源自人类的爬行动物祖先，包含几个不同的结构，如丘脑、小脑和脑干。它调节身体的基础功能——比如呼吸心跳，产生反射行为——比如从火中抽手、闪避迎面而来的物体，还产生情感——比如欲望和愤怒。</p>
<p>新脑，包裹在旧脑之外，新脑和旧脑通过神经纤维——也就是<strong>白质</strong>——相连。</p>
<p>旧脑包含几十个独立的器官，每个器官都有特定的功能，它们彼此分离。例如，杏仁核中有数个豌豆大小的器官，负责不同类型的攻击行为，如有预谋的攻击和冲动性攻击。</p>
<h3 id="脑区">脑区<a hidden class="anchor" aria-hidden="true" href="#脑区">#</a></h3>
<p>新脑却完全不同。虽然它约占据了大脑体积的70%，并负责很多认知功能，但它看上去并没有明显的分界线。褶皱是为了使得新皮质以更大的表面积塞入颅骨内。如果忽略这些褶皱，那么新皮质看起来就像一大片细胞，并没有明显的分界线。</p>
<p>尽管如此，新脑仍被划分为几十个被称作脑区的区域。每个脑区执行不同的功能，视觉、听觉、触觉等等，还有的负责语言和计划等。当区域受损时，导致相应功能出现问题。例如，后脑勺的损伤会导致失明，而左侧大脑的损伤可能会导致丧失语言能力。</p>
<p><img loading="lazy" src="/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/%E8%84%91%E5%8C%BA.gif#center"></p>
<p>新皮质是智能的器官。它是一张桌布大小的神经组织，分为几十个区域。有些区域负责视觉、听觉、触觉和语言，还有一些不容易被标签化的区域，负责更高层面的思考和计划。这些区域通过神经纤维束相互连接。</p>
<p>演化中，大脑通过在旧脑上长出新脑而变大。旧脑控制着更原始的行为，而新脑则创造出更复杂的行为。</p>
<p>新皮质的每一个区域，都发现了投射到旧脑中的神经元。如果你将一个新皮质区与眼睛相连，就得到了视觉。如果你将同一皮质区与耳朵相连，就得到了听觉。比如，一些病人在失去了视力之后，原先的视力区域就可以用来处理听觉，因而其听觉特别灵敏。如果你将两个不同的皮质区相连，你就得到了高级思维，如语言或者通感。</p>
<p>达尔文认为，生命多样性是基于一种基本算法——也就是我反复阐述的<a href="/evolution/5_%E6%BC%94%E5%8C%96%E7%9A%84%E7%AE%97%E6%B3%95%E4%B8%8E%E8%B6%8B%E5%8A%BF#%E5%8F%98%E5%8C%96%E4%B8%8E%E9%80%89%E6%8B%A9">演化公式</a>。同样，从宏观上来讲，智能的多样性也是基于这种基本算法，而它的演化发生地就是大脑内部的众多神经元及其网络，以及神经元之间的天文数字的连接点上。</p>
<h3 id="新旧脑的分工">新旧脑的分工<a hidden class="anchor" aria-hidden="true" href="#新旧脑的分工">#</a></h3>
<p>新脑与旧脑代表着大脑内部的两个阵营：</p>
<ul>
<li>一个负责语言、理性、高级的知觉。</li>
<li>一个负责欲望、情绪和初级的知觉。</li>
</ul>
<p>它们之间的协作与竞争可以作为简化模型，解释许多日常的心理模式。</p>
<p>相对而言，新脑处于弱势的地位，因为它不能直接控制肌肉。与旧脑不同，新脑中没有神经元直接与肌肉相连，它不能使任何肌肉动起来。当新脑想做什么时，它会向旧脑发出一个信号，要求旧脑听从它的命令。</p>
<p>看过书籍 <a href="https://zh.wikipedia.org/zh-cn/%E5%BF%AB%E6%80%9D%E6%85%A2%E6%83%B3">《思考，快与慢》</a>的朋友们应该很容易地联想到，旧脑负责快思维，新脑负责慢思维。这种看法大差不离。但是，在后面的探讨中我们会知道，思维是必然同时发生在新脑与旧脑上的，它们二者的互动——也就是神经信号在新脑与旧脑之间通过脑白质的 <strong>折返循环</strong> ——才构成了我们能够意识到的思维过程。只是，在某个具体时刻，有可能是新脑占据主动地位，体现为慢思维。而在另外一个时刻，可能是旧脑占据主动，体现为快思维。</p>
<p><strong>新脑与旧脑的竞争与协作，始终贯穿在我们的感觉与意识中。</strong></p>
<p>比如，当我们看到满满一碗油光发亮的红烧肉时，旧脑会发出大块耳颐的信号，而新脑会评估这些油腻五花肉的热量以及自己的高血脂，从而决定只能吃一块。再比如，当我们感到愤怒时，会有爆粗口甚至动手的冲动。此时，新脑会告诉我们冷静下来，避免做出过激的举动。</p>
<p>但是，在巨大压力下或者面临危险时，旧脑会爆发强烈的情绪，压制新脑的理性思考，导致人们做出非理性的行为。另外，旧脑的奖励机制，比如对食物、性、毒品的渴望，与新脑的长期目标，比如健康、事业、家庭，产生直接冲突，导致上瘾者做出只顾眼前的选择。</p>
<p>新脑与旧脑之间的竞争，还有一个鲜为人知的例子。</p>
<p>有过牙疼经历的人们都知道，牙痛非常强烈，甚至已经到了有违常理，不必要地干扰正常生活的地步。小小一个牙齿根部的炎症，就能够让我们痛得呼天喊地，面部麻木，生活失常。从生存的角度来看，这真的有必要吗？</p>
<p>其实，这是源于旧脑与新脑之间的竞争。</p>
<p>痛觉是身体发出的警告信号，会先传递到旧脑，然后再由旧脑传递给新脑。一般而言，旧脑会放大痛觉的感受，以确保引起新脑足够的重视。新脑则负责对疼痛的评估，安排后续处理。旧脑要的是快速反应，就像我们从火苗中快速抽手那样。新脑则倾向于分析原因，获得最优行动方案。这样，二者产生了对支配身体的竞争。旧脑为了获得主导权，它能做的就是不计后果地强化痛感以及情绪反应，驱使人们尖叫、哭泣、捶胸顿足，甚至到了干扰新脑思考与决策的地步。</p>
<p>那么，新脑与旧脑相比，构造有什么不同吗？</p>
<h1 id="皮质柱">皮质柱<a hidden class="anchor" aria-hidden="true" href="#皮质柱">#</a></h1>
<p>新皮质扩大是通过对一个基本单元的多次<strong>复制</strong>而实现的。演化中，新皮质的面积越变越大，但厚度却没有增加。人脑新皮质比老鼠或狗的新皮质大得多，但其实它们都是由相同的基本部分组成的，人脑新皮质只是包含更多的基本单元而已。这些区域之所以看起来相似，还因为它们都在做着同样的事情。使这些区域有所区别的不是它们的内在功能，而是它们所连接的输入。甚至老鼠、猫和人类等不同物种的新皮质的结构看起来都很相似。</p>
<p>如果展开人脑的新皮层，它面积大致相当于一块桌布，厚度约为2.5毫米。新皮层中有数十个区域，不同区域具有不同的功能，比如视觉、触觉、语言、规划等等。如果切开某个区域，我们会看到数十种不同类型的神经元排列在多个水平层上，层层叠加，具有复杂的连接。然而，尽管这些回路非常复杂，但在所有区域之间，它们却是相对一致的，无论这些区域的功能是什么。在新皮质的任何地方，我们都会看到大致相同的结构。</p>
<p>这个相同的基本单元就是 <a href="https://zh.wikipedia.org/zh-cn/%E7%9A%AE%E5%B1%82%E6%9F%B1">皮质柱</a> ，这个概念是 <a href="https://en.wikipedia.org/wiki/Vernon_Benjamin_Mountcastle">弗农·芒卡斯尔</a> 提出的。</p>
<p>皮质柱是按照 <a href="https://en.wikipedia.org/wiki/Receptive_field">感受野</a> 划分的面积大小约一个平方毫米的新皮质组织，包含一组神经元，它们在新皮质中形成一个圆柱形结构，垂直于皮质表面。皮质柱又由上百个 <a href="https://en.wikipedia.org/wiki/Cortical_minicolumn">微皮层柱</a> 组合而成。微柱中的神经元只能处理相同特征的信号，它们每个都包含相同类型的神经元。皮层柱则是一个可以处理其相应感受野中全部有效信号的单元。</p>
<p><img loading="lazy" src="/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/%E7%9A%AE%E8%B4%A8%E6%9F%B1.gif#center"></p>
<p>皮质柱与微皮质柱的示意图，图片来自维基百科。</p>
<p>所谓的 <a href="https://zh.wikipedia.org/zh-cn/%E6%84%9F%E5%8F%97%E9%87%8E">感受野</a>，可以简单理解为，在身体组织中，神经末梢能够感受信号的最小单元。比如我们皮肤上的一片微小区域，这片区域共用一个神经末梢，其感受并传递冷热、压力、触觉、痛觉等等信号。那么，这一片微小区域，就是一个感受野。它在大脑新皮质上，必然也有一个皮质柱与之对应，处理这个感受野的所有感觉信号。这个皮质柱中有很多微柱，它们各自分别处理冷热的、压力的、触觉的，痛觉的信号。</p>
<p>所以，感受野是感觉信号的发源地，而皮质柱是感觉信号的处理器。当然，在感觉信号到达皮质柱之前，它们会先在旧脑停留，经由初步处理后，再由丘脑分发到新皮质处的相应皮质柱来处理。</p>
<p>皮质柱也是按照神经元的层次结构来划分的：</p>
<p><img loading="lazy" src="/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/%E7%9A%AE%E8%B4%A8%E6%9F%B1%E5%B1%82%E7%BA%A7.gif#center">
新皮质中的神经元的分布的一个切面，图片来自维基百科。</p>
<p>想象你向一个试管中先后倒入一些豌豆、扁豆和大豆。然后从侧面看这个管子，你会看到3层。<a href="https://zh.wikipedia.org/zh-cn/%E5%9C%A3%E5%9C%B0%E4%BA%9A%E5%93%A5%C2%B7%E6%8B%89%E8%92%99-%E5%8D%A1%E5%93%88%E5%B0%94">卡哈尔</a> 看到了6层。第1层是最外侧靠近头皮，是上图的顶部。第6层是最内侧，离头皮最远，是上图中的下部。</p>
<p>新皮质中，大多数神经元的轴突在层与层之间运行，垂直于新皮质的表层。只有少数神经元具有长距离的水平连接。这意味着，信息的处理是主要在本地层间进行，然后再进行远距离横向传递。这完全符合我一再强调的大自然演化中的<a href="/evolution/5_%E6%BC%94%E5%8C%96%E7%9A%84%E7%AE%97%E6%B3%95%E4%B8%8E%E8%B6%8B%E5%8A%BF#%E5%88%86%E6%95%A3%E8%AE%A1%E7%AE%97">分散计算</a> 的原则。</p>
<p>一根皮质柱大约占据了1平方毫米的皮质表面积，高2.5毫米。人脑新皮质中大约有15万根皮质柱并排堆叠在一起。在这2.5立方毫米体积的皮质柱中，大约有10万个神经元，5亿个突触，以及几千米长的轴突和树突。</p>
<p><img loading="lazy" src="/mind/2_%E6%96%B0%E8%84%91%E4%B8%8E%E6%97%A7%E8%84%91/%E7%9A%AE%E8%B4%A8%E6%9F%B1%E6%8E%92%E5%88%97.gif#center"></p>
<p>新皮层中的15万个皮质柱排列在一起，每个皮质柱是有多个上下层级组成的。</p>
<p>皮质柱之间并无明显的界限。科学家之所以能够确立皮质柱之间界限的存在，是因为同一皮质柱中的所有神经元都会对视网膜的同一个部分或皮肤的同一片区域做出反应，而相邻皮质柱则会对其他部分或区域做出反应，这片区域就是前述的感受野。例如，在小鼠和大鼠身上，每根胡须会有一根对应的皮质柱。每一个从丘脑上行到新皮质的视神经轴突，都会有一个皮质柱与之衔接。同时，每个皮质柱的下端都伸出更多的轴突返回到丘脑。</p>
<p>皮质柱的最下端，也就是第六层下端，有大量的神经元轴突，远程通向到丘脑。这种连接皮质柱和丘脑的轴突连接，构成了我们后面要讨论的非常重要的一个概念，<strong>折返网络</strong>。</p>
<p>在皮质柱的第二层和第三层，则存在大量的横向连接，将该皮质柱与其他皮质柱广泛地连接起来。</p>
<p>每根皮质柱可以被进一步分成几百个迷你皮质柱，它们每个包含100多个横跨各层的神经元。与皮质柱不同，迷你皮质柱的清晰可见的物理区隔可以被显微镜观察到。</p>
<p>现在我们想象一下，新皮质是一张2.5毫米厚的桌布。它分为几十个区域，每个区域做着不同的事情。每个区域由成千上万根皮质柱组成，每根皮质柱由几百个发丝状的迷你皮质柱组成，每个迷你皮质柱由一百多个神经元组成。</p>
<p>皮质柱被认为是新皮质能够进行思维的关键。</p>
<p>从演化史来看，智人的新脑增大在演化过程中发生得太快，只有短短几百万年的时间。这段时间可能不足以使大脑演化出全新能力，但足够产生更多的副本。人脑增大是通过以单个皮质柱为模板，进行大量复制来达成的。这种演化使得人脑新皮质的大小在过去的 300 万年里增加了近 3 倍。简单地说，以量取胜。</p>
<p>虽然智能的形式多种多样，但是，新皮质各区域的皮质柱结构非常一致。这暗示着，应该有一个通用算法来处理各种信号，形成各种智能。毕竟，颅骨中黑暗密闭的大脑不与外界直接接触，它处理的是各类信号，不管是声音、图像、气味还是触觉。<strong>基于信号处理的算法可以通用</strong>。不管是预测、交流还是抽象思维，凡是智能的东西，其底层算法应该是一致的。</p>
<p>另一方面，我们能够学习掌握各种新东西，从滑雪冲浪、外语翻译、计算机编程到绘画建模，这也说明了人脑的通用适应性。那些先天失明的人们，其新皮质的视觉区转而承担一些与听觉或触觉有关的处理，这同样体现了通用算法的内在一致性。</p>
<p>所以，本章节我们要探讨的关键问题是，这个通用算法到底是什么？</p>
<p>让我们从最基本的构造单元——神经元——开始说起。</p>


  </div>



  <footer class="post-footer">
    <ul class="post-tags">
    </ul>


    


        
      <nav class="paginav">
            
      
      
      
      <a class="prev" href="http://localhost:1313/mind/1_%E4%BD%9C%E4%B8%BA%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BA%BA%E8%84%91/">
        <span class="title">« 上一篇</span>
        <span>作为工具的人脑</span>
      </a>
      

      
      
      <a class="next" href="http://localhost:1313/mind/3_%E7%A5%9E%E7%BB%8F%E5%85%83%E4%B8%8E%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">
        <span class="title">下一篇 »</span>
        <span>神经元与神经网路</span>
      </a>
      
      

    </nav>    
    

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">祁观</a></span>

</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
